<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
    <meta content='width=device-width, initial-scale=1' name='viewport'>
    <link href='../../assets/images/businesscore-64x64.png' rel='icon'>
    <title>CGC Docs | cb-server</title>
    <link href="../../assets/stylesheets/application.css" rel="stylesheet" />
  </head>
  <body class='service-launcher service-launcher_cb-server service-launcher_cb-server_index'>
    <div id='container'>
      <div id='nav_col'>
        <div id='logo'>
          <a href='/'>
            CGC Docs, published by Legitimate Business Syndicate
          </a>
        </div>
        <div id='nav'>
          <ul>
            <li>
              <a href='/'>Welcome</a>
            </li>
            <li class='hdr'>Event-FAQ</li>
            <li>
              <a href='/Event-FAQ/event_faq/'>Event FAQ</a>
            </li>
            <li class='hdr'>cb-testing</li>
            <li>
              <a href='/cb-testing/cb-acceptance/'>cb-acceptance</a>
            </li>
            <li>
              <a href='/cb-testing/cb-replay/'>cb-replay</a>
            </li>
            <li>
              <a href='/cb-testing/cb-replay-pov/'>cb-replay-pov</a>
            </li>
            <li>
              <a href='/cb-testing/cb-test/'>cb-test</a>
            </li>
            <li>
              <a href='/cb-testing/poll-validate/'>poll-validate</a>
            </li>
            <li class='hdr'>cgc-release-documentation/newsletter</li>
            <li>
              <a href='/cgc-release-documentation/newsletter/ipc/'>News Letter 1: IPC</a>
            </li>
            <li>
              <a href='/cgc-release-documentation/newsletter/cpp/'>News Letter 2: C++</a>
            </li>
            <li>
              <a href='/cgc-release-documentation/newsletter/ctf/'>News Letter 3: CTF</a>
            </li>
            <li>
              <a href='/cgc-release-documentation/newsletter/template/'>News Letter X: Template</a>
            </li>
            <li class='hdr'>cgc-release-documentation/walk-throughs</li>
            <li>
              <a href='/cgc-release-documentation/walk-throughs/building-a-cb/'>Building a Challenge Binary</a>
            </li>
            <li>
              <a href='/cgc-release-documentation/walk-throughs/cgc-repository/'>CGC Repositories</a>
            </li>
            <li>
              <a href='/cgc-release-documentation/walk-throughs/debugging-a-cb/'>Debugging a Challenge Binary</a>
            </li>
            <li>
              <a href='/cgc-release-documentation/walk-throughs/pin-for-decree/'>Running Intel PIN on DECREE Challenge Binaries</a>
            </li>
            <li>
              <a href='/cgc-release-documentation/walk-throughs/running-the-vm/'>Running the Virtual Machine</a>
            </li>
            <li>
              <a href='/cgc-release-documentation/walk-throughs/scoring-cbs/'>Scoring a Challenge Binary Set</a>
            </li>
            <li>
              <a href='/cgc-release-documentation/walk-throughs/submitting-a-cb/'>Submitting a Challenge Binary</a>
            </li>
            <li>
              <a href='/cgc-release-documentation/walk-throughs/testing-a-cb/'>Testing a Challenge Binary</a>
            </li>
            <li>
              <a href='/cgc-release-documentation/walk-throughs/understanding-poll-generators/'>Understanding Poll Generators</a>
            </li>
            <li>
              <a href='/cgc-release-documentation/walk-throughs/understanding-cfe-povs/'>Understanding Proofs of Vulnerability in CFE</a>
            </li>
            <li>
              <a href='/cgc-release-documentation/walk-throughs/using-the-network-appliance/'>Using the Network Appliance</a>
            </li>
            <li>
              <a href='/cgc-release-documentation/walk-throughs/virtual-competiton/'>Virtual Competition</a>
            </li>
            <li>
              <a href='/cgc-release-documentation/walk-throughs/ptrace-for-decree/'>Writing an Instruction Tracer for DECREE Challenge Binaries Using ptrace</a>
            </li>
            <li class='hdr'>cgc2elf</li>
            <li>
              <a href='/cgc2elf/cgc2elf/'>cgc2elf</a>
            </li>
            <li class='hdr'>cgcef-verify</li>
            <li>
              <a href='/cgcef-verify/cgcef_verify/'>cgcef_verify</a>
            </li>
            <li class='hdr'>libcgc</li>
            <li>
              <a href='/libcgc/allocate/'>allocate</a>
            </li>
            <li>
              <a href='/libcgc/cgcabi/'>CGC ABI</a>
            </li>
            <li>
              <a href='/libcgc/deallocate/'>deallocate</a>
            </li>
            <li>
              <a href='/libcgc/fdwait/'>fdwait</a>
            </li>
            <li>
              <a href='/libcgc/random/'>random</a>
            </li>
            <li>
              <a href='/libcgc/receive/'>receive</a>
            </li>
            <li>
              <a href='/libcgc/terminate/'>_terminate</a>
            </li>
            <li>
              <a href='/libcgc/transmit/'>transmit</a>
            </li>
            <li class='hdr'>libcgcef</li>
            <li>
              <a href='/libcgcef/cgc_executable_format/'>CGC Executable Format</a>
            </li>
            <li class='hdr'>libpov</li>
            <li>
              <a href='/libpov/libpov/'>libpov</a>
            </li>
            <li>
              <a href='/libpov/type1_negotiate/'>type1_negotiate</a>
            </li>
            <li>
              <a href='/libpov/type2_negotiate/'>type2_negotiate</a>
            </li>
            <li>
              <a href='/libpov/type2_submit/'>type2_submit</a>
            </li>
            <li class='hdr'>network-appliance</li>
            <li>
              <a href='/network-appliance/cb-packet-log/'>cb-packet-log</a>
            </li>
            <li>
              <a href='/network-appliance/cb-proxy/'>cb-proxy</a>
            </li>
            <li>
              <a href='/network-appliance/verify-rules/'>verify-rules</a>
            </li>
            <li class='hdr'>poll-generator</li>
            <li>
              <a href='/poll-generator/generate-polls/'>generate-polls</a>
            </li>
            <li class='hdr'>pov-xml2c</li>
            <li>
              <a href='/pov-xml2c/pov-xml2c/'>pov-xml2c</a>
            </li>
            <li class='hdr'>service-launcher</li>
            <li>
              <a href='/service-launcher/cb-server/'>cb-server</a>
            </li>
            <li class='hdr'>virtual-competition</li>
            <li>
              <a href='/virtual-competition/ti-client/'>ti-client</a>
            </li>
            <li>
              <a href='/virtual-competition/ti-rotate/'>ti-rotate</a>
            </li>
            <li>
              <a href='/virtual-competition/ti-server/'>ti-server</a>
            </li>
          </ul>
        </div>
      </div>
      <div id='main_col'>
        <div id='title'>
          <h1>cb-server</h1>
        </div>
        <div id='content'>
          <p>cb-server - Challenge Binary launch daemon</p>
          
          <h1 id="synopsis">SYNOPSIS</h1>
          
          <div class="language-sh highlighter-rouge"><pre class="highlight"><code>cb-server <span class="o">[</span>options] -p PORT -d DIRECTORY challenge-binary <span class="o">[</span>... challenge-binary]&#x000A;</code></pre>
          </div>
          
          <h1 id="description">DESCRIPTION</h1>
          
          <p><code class="highlighter-rouge">cb-server</code> is a inetd style TCP server, launching instances of the specified challenge binaries for each connection within a restricted environment.  Challenge binaries are able to communicate via the TCP connection with the use of <code class="highlighter-rouge">STDIN</code> and <code class="highlighter-rouge">STDOUT</code>.</p>
          
          <h1 id="arguments">ARGUMENTS</h1>
          
          <dl>
            <dt><code class="highlighter-rouge">-p PORT</code></dt>
            <dd>Specify the TCP Port used for incoming connections.</dd>
            <dt><code class="highlighter-rouge">-d DIRECTORY</code></dt>
            <dd>Specify the directory containing the challenge binaries</dd>
            <dt><code class="highlighter-rouge">challenge-binary</code></dt>
            <dd>The specified <code class="highlighter-rouge">challenge-binary</code>.  <em>NOTE:</em> The file must exist in the specified directory.</dd>
          </dl>
          
          <h1 id="options">OPTIONS</h1>
          
          <dl>
            <dt><code class="highlighter-rouge">-h</code></dt>
            <dd>Display a usage message and exit</dd>
            <dt><code class="highlighter-rouge">-c SIZE</code></dt>
            <dd>Specify a maximum core file size.  Specifying a <code class="highlighter-rouge">SIZE</code> value of 0 will disable creating core files.</dd>
            <dt><code class="highlighter-rouge">-w WRAPPER</code></dt>
            <dd>Specify an executable that will wrap the containing challenge binaries</dd>
            <dt><code class="highlighter-rouge">-e ENV</code></dt>
            <dd>Specify an enviornment variable to pass to the challege binary or wrapper</dd>
            <dt><code class="highlighter-rouge">-s SEED</code></dt>
            <dd>Specify the per-process PRNG seed.</dd>
            <dt><code class="highlighter-rouge">-S SKIPRNG</code></dt>
            <dd>Specify the amount to advance the PRNG state before launching the challenge binary</dd>
            <dt><code class="highlighter-rouge">-t TIMEOUT</code></dt>
            <dd>Specify the maximum amount of time each instance of a challenge binary may execute.  Specifying a <code class="highlighter-rouge">TIMEOUT</code> value of 0 will use the default value.</dd>
            <dt><code class="highlighter-rouge">-b BACKLOG</code></dt>
            <dd>Specify the maximum amount of pending TCP connections that can be held while existing instances are executing.</dd>
            <dt><code class="highlighter-rouge">-m MAX_CONNECTIONS</code></dt>
            <dd>Specify the maximum total connections to accept.</dd>
            <dt><code class="highlighter-rouge">-l CHILDREN</code></dt>
            <dd>Specify the maximum amount of concurrently executing challenge binaries.</dd>
            <dt><code class="highlighter-rouge">--insecure</code></dt>
            <dd>Launch the challenge binaries in a less restricted environment</dd>
            <dt><code class="highlighter-rouge">--no_attach</code></dt>
            <dd>Do not attach to the processes (Will prevent the POV verification from working)</dd>
            <dt><code class="highlighter-rouge">--debug</code></dt>
            <dd>Enable debugging output.</dd>
          </dl>
          
          <h1 id="restricted-environment">RESTRICTED ENVIRONMENT</h1>
          
          <p><code class="highlighter-rouge">cb-server</code> performs numerous actions to restrict the execution environment of the challenge binaries before execution.</p>
          
          <dl>
            <dt><code class="highlighter-rouge">chroot</code></dt>
            <dd><code class="highlighter-rouge">cb-server</code> will <code class="highlighter-rouge">chroot</code> into the directory specified via command-line argument unless the <code class="highlighter-rouge">--insecure</code> option is specified.  The <code class="highlighter-rouge">--insecure</code> flag will not <code class="highlighter-rouge">chroot</code>, rather <code class="highlighter-rouge">chdir</code> to the specified directory.  This reduces the ability of the challenge binaries to impact the rest of the running system.</dd>
            <dt><code class="highlighter-rouge">random UID/GID</code></dt>
            <dd><code class="highlighter-rouge">cb-server</code> will identify an unused uid and gid via <code class="highlighter-rouge">getpwuid</code> and <code class="highlighter-rouge">getgrgid</code> respectively for each connection, setting the UID and GID to the identified values prior to execution of the challenge binaries.  This reduces the ability of the challenge binary to impact other instances of challenge binaries.</dd>
            <dt><code class="highlighter-rouge">rlimits</code></dt>
            <dd><code class="highlighter-rouge">cb-server</code> will set the maximum number of file descriptors that may be opened, bytes that can be allocated for message queues, number of <code class="highlighter-rouge">flock</code>/<code class="highlighter-rouge">fcntl</code> locks that may be established, and amount of memory that can be locked into ram to 0.  The maximum size of the process stack for the challenge binaries is set to 8MB.  The maximum size of the data segment for the challenge binaries is set to 1GB.</dd>
          </dl>
          
          <h1 id="challenge-binary-ipc">CHALLENGE BINARY IPC</h1>
          
          <p><code class="highlighter-rouge">cb-server</code> allows for IPC between multiple challenge binaries per connection via sockets allocated via <code class="highlighter-rouge">sockpair</code>.   If multiple binaries are specified on the command line, an additional sockpair is created for each binary.  All sockets, including the original <code class="highlighter-rouge">STDIN</code>, <code class="highlighter-rouge">STDOUT</code>, and <code class="highlighter-rouge">STDERR</code>, are made available to all of the specified challenge binaries.</p>
          
          <p>This allows a CB author wishing to use IPC to complex multi-process challenges, including pipelined services or producer/consumer models.</p>
          
          <p>The TCP connection is available to the challenge binaries via the file descriptor 0 and 1, <code class="highlighter-rouge">STDIN</code> and <code class="highlighter-rouge">STDOUT</code> respectively, the file descriptor 2 used for debugging purposes as <code class="highlighter-rouge">STDERR</code>, with each additional socket allocated sequentially starting at 3.</p>
          
          <h1 id="example-uses">EXAMPLE USES</h1>
          
          <dl>
            <dt><code class="highlighter-rouge">cb-server -p 10000 -d /tmp cb1</code></dt>
            <dd>This will create a server to handle network connections on TCP port 10000, chrooting to <code class="highlighter-rouge">/tmp</code>, and setting the UID and GID to random unused values, launching <code class="highlighter-rouge">cb1</code> upon each connection.</dd>
            <dt><code class="highlighter-rouge">cb-server --insecure -p 10000 -d /bin echo</code></dt>
            <dd>This will create a server to handle network connections on TCP port 10000, changing directory to <code class="highlighter-rouge">/bin</code>, launching <code class="highlighter-rouge">cb1</code> upon each connection.</dd>
            <dt><code class="highlighter-rouge">cb-server -p 10000 -d /tmp cb1 cb2 cb3</code></dt>
            <dd>This will create a server to handle network connections on TCP port 10000, chrooting to <code class="highlighter-rouge">/tmp</code>, and setting the UID and GID to random unused values, launching <code class="highlighter-rouge">cb1</code>, <code class="highlighter-rouge">cb2</code>, and <code class="highlighter-rouge">cb3</code> upon each connection.  Three additional socketpairs will be allocated and provided to each of the processes, with the IDs 3, 4, 5, 6, 7, and 8</dd>
          </dl>
          
          <h1 id="copyright">COPYRIGHT</h1>
          
          <p>Copyright (C) 2014, Brian Caswell</p>
          
          <h1 id="see-also">SEE ALSO</h1>
          
          <p>setrlimit(2),
          chroot(2),
          getpwuid(3),
          getgrgid(3),
          socketpair(2)</p>
          
          <p>For more information relating to DARPA's Cyber Grand Challenge, please visit <a href="http://www.darpa.mil/cybergrandchallenge/">http://www.darpa.mil/cybergrandchallenge/</a></p>
        </div>
      </div>
    </div>
    <footer>
      <div id='impressum'>Published by Legitimate Business Syndicate</div>
      <div id='timestamp'>Built at 2016-05-20T18:14:53Z</div>
      <div>
        <ul>
          <li><a href="https://legitbs.net">Homepage</a></li>
          <li><a href="https://twitter.com/legitbs_ctf">Twitter</a></li>
          <li><a href="https://github.com/legitbs">GitHub</a></li>
          <li><a href="https://github.com/legitbs/cgc-docs">This repo</a></li>
        </ul>
      </div>
    </footer>
    <script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
    <script src="../../assets/javascripts/application.js"></script>
  </body>
</html>
